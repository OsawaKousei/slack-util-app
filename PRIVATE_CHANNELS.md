# プライベートチャンネルのアーカイブについて

## 📌 重要な仕様

Slack のセキュリティ仕様により、**ボットアプリはプライベートチャンネルに招待されない限り、そのチャンネルのメッセージを読み取ることができません**。

## 🔧 プライベートチャンネルをアーカイブする方法

### 方法 1: ボットを各プライベートチャンネルに招待する（推奨）

1. **アーカイブしたいプライベートチャンネルを開く**
2. **ボットを招待する**
   - チャンネルの詳細を開く
   - 「インテグレーション」タブを選択
   - 「アプリを追加」をクリック
   - `slack-util-app`を選択して追加

または、チャンネル内で以下のコマンドを実行:

```
/invite @slack-util-app
```

3. **`/slack-archive`コマンドを実行**
   - ボットが参加しているプライベートチャンネルは自動的にアーカイブされます

### 方法 2: 一括でボットを招待する

複数のプライベートチャンネルがある場合:

1. **各プライベートチャンネルで`/invite @slack-util-app`を実行**
2. **`/slack-archive`コマンドを 1 回実行**
   - すべての参加済みチャンネルが自動的にアーカイブされます

## 📊 アーカイブ結果の確認

`/slack-archive`コマンドを実行すると、以下の情報が表示されます:

```
✅ アーカイブが完了しました！

📊 アーカイブサマリー
• 対象期間: 過去24時間
• 総チャンネル数: 15
• アーカイブ成功: 10チャンネル
• スキップ: 5チャンネル
  - プライベート(未参加): 3
  - アーカイブ済み: 2
  - その他: 0
• メッセージ総数: 245件
• ファイル名: slack-archive-20251017-150000.json
• 保存先: Google Drive

💡 プライベートチャンネルについて
プライベートチャンネルをアーカイブするには、各チャンネルにボットを招待してください。
スキップされたチャンネルの詳細はアーカイブファイルをご確認ください。
```

## 📁 アーカイブファイルの内容

Google Drive に保存される JSON ファイルには、スキップされたチャンネルの詳細情報も含まれます:

```json
{
  "archiveDate": "2025-10-17T06:00:00.000Z",
  "lookBackHours": 24,
  "channels": [
    {
      "id": "C123456",
      "name": "general",
      "is_private": false,
      "messageCount": 45,
      "messages": [...]
    }
  ],
  "skippedChannels": [
    {
      "name": "secret-project",
      "id": "C789012",
      "reason": "private_not_member"
    }
  ]
}
```

### スキップ理由の種類

- `private_not_member`: プライベートチャンネルで、ボットが招待されていない
- `archived`: アーカイブ済みのチャンネル
- `join_failed`: パブリックチャンネルだが参加に失敗
- `error`: その他のエラー

## ⚠️ 制限事項

### できること

- ✅ ボットが参加しているパブリックチャンネルのアーカイブ
- ✅ ボットが招待されているプライベートチャンネルのアーカイブ
- ✅ パブリックチャンネルへの自動参加とアーカイブ

### できないこと

- ❌ ボットが招待されていないプライベートチャンネルのアーカイブ
- ❌ ユーザー権限なしでの全チャンネルアクセス

## 🔐 セキュリティに関する注意

プライベートチャンネルのこの制限は、**Slack のセキュリティとプライバシーを保護するための重要な機能**です。

もし管理者権限で全チャンネルにアクセスする必要がある場合は、User Token を使用する方法もありますが、以下の理由から**推奨されません**:

- セキュリティリスクが高い
- ユーザートークンの有効期限管理が必要
- 監査ログに個人として記録される
- Slack のポリシーに抵触する可能性

## 💡 ベストプラクティス

1. **アーカイブ対象のチャンネルを事前に決定**
2. **対象のプライベートチャンネルにボットを招待**
3. **定期的に`/slack-archive`を実行**
4. **アーカイブファイルで結果を確認**
5. **スキップされたチャンネルがあれば、必要に応じてボットを招待**

## 🆘 トラブルシューティング

### Q: プライベートチャンネルがアーカイブされない

**A:** そのチャンネルでボットを招待してください: `/invite @slack-util-app`

### Q: 「Could not join channel」エラーが出る

**A:** パブリックチャンネルでもアクセス制限がかかっている場合があります。管理者に確認してください。

### Q: すべてのプライベートチャンネルを一度にアーカイブしたい

**A:** 各プライベートチャンネルでボットを招待する必要があります。Slack API を使った自動招待も可能ですが、User Token（管理者権限）が必要です。

## 📞 サポート

問題が解決しない場合は、ログスプレッドシートを確認するか、管理者にお問い合わせください。
